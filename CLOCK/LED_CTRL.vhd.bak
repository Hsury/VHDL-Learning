--数码管控制模块 2017/04/11
LIBRARY IEEE;
USE IEEE.STD_LOGIC_1164.ALL;

ENTITY LED_CTRL IS
	PORT (CLK_1KHZ : IN STD_LOGIC;	--1KHz时钟
	      CLK_1HZ : IN STD_LOGIC;	--1Hz时钟
	      HOUR_HIGH : IN INTEGER RANGE 0 TO 2;
	      HOUR_LOW : IN INTEGER RANGE 0 TO 9;
	      MINUTE_HIGH : IN INTEGER RANGE 0 TO 5;
	      MINUTE_LOW : IN INTEGER RANGE 0 TO 9;
	      SECOND_HIGH : IN INTEGER RANGE 0 TO 5;
	      SECOND_LOW : IN INTEGER RANGE 0 TO 9;
	      CURRSOR : OUT STD_LOGIC_VECTOR (2 DOWNTO 0);
	      DATA : OUT INTEGER RANGE 0 TO 9;
	      DP : OUT STD_LOGIC);
END LED_CTRL;

ARCHITECTURE BEHAV OF LED_CTRL IS
BEGIN
	PROCESS(CLK_1KHZ)
		VARIABLE CNT : INTEGER RANGE 0 TO 5;
	BEGIN
		IF RISING_EDGE(CLK_1KHZ) THEN
			CASE CNT IS
				WHEN 0 => CURSOR <= "000";	DATA <= HOUR_HIGH;
				WHEN 1 => CURSOR <= "001";	DATA <= HOUR_LOW;	IF CLK_1HZ = '1' THEN DP <= '1'; ELSE DP <= '0'; END IF;
				WHEN 2 => CURSOR <= "010";	DATA <= MINUTE_HIGH;
				WHEN 3 => CURSOR <= "011";	DATA <= MINUTE_LOW;	IF CLK_1HZ = '1' THEN DP <= '1'; ELSE DP <= '0'; END IF;
				WHEN 4 => CURSOR <= "100";	DATA <= SECOND_HIGH;
				WHEN 5 => CURSOR <= "101";	DATA <= SECOND_LOW;
				WHEN OTHERS => CURSOR <= "000"; DATA <= 0;
			END CASE;
			IF CNT = 5 THEN
				CNT := 0;
			ELSE
				CNT := CNT + 1;
			END IF;
		END IF;
	END PROCESS;
END BEHAV;